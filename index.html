<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="nav.css">
</head>

<body>
  <div class="main">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <button onclick="toggleSidebar()">/|\</button>
        <span class="app-name">LogiTrack</span>
      </div>
      <ul class="menu">
        <li><a href="index.html" class="active">Dashboard</a></li>
        <li><a href="Orderpage.html">Orders</a></li>
        <li><a href="FleetPage.html">Fleet</a></li>
        <li><a href="reports.html">Reports</a></li>
        <li><a href="SettingPage.html">Settings</a></li>
      </ul>
    </div>

    <div class="main-content" id="main">
      <div class="header">
        <h1>Dashboard</h1>
        <p class="">Admin</p>
      </div>

      <!-- Your original KPI cards with enhanced data -->
      <div class="orders">
        <div class="order">
          <h3>Active Deliveries</h3>
          <h2 id="blue">147</h2>
          <div class="performance-metric metric-up">
            ↗ 12% from last week
          </div>
        </div>
        <div class="order">
          <h3>Pending Pickups</h3>
          <h2 id="orange">23</h2>
          <div class="performance-metric metric-down">
            ↘ 5% from yesterday
          </div>
        </div>
        <div class="order">
          <h3>Completed Orders</h3>
          <h2 id="green">892</h2>
          <div class="performance-metric metric-up">
            ↗ 8% from last month
          </div>
        </div>
        <div class="order">
          <h3>Fleet Utilization</h3>
          <h2 id="purple">87%</h2>
          <div class="performance-metric metric-up">
            ↗ 3% efficiency gain
          </div>
        </div>
        <div class="order">
          <h3>Delayed Shipments</h3>
          <h2 id="red">12</h2>
          <div class="performance-metric metric-down">
            ↗ 3 more than yesterday
          </div>
        </div>
        <div class="order">
          <h3>Revenue Today</h3>
          <h2 id="teal">₦2.1M</h2>
          <div class="performance-metric metric-up">
            ↗ 15% from yesterday
          </div>
        </div>
      </div>

      <!-- Enhanced Charts Section -->
      <div class="chart-section">
        <!-- Main Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="chart-container">
            <div class="chart-title">Daily Shipment Volume</div>
            <canvas id="shipmentVolumeChart" style="max-height: 400px;" height="100"></canvas>
          </div>
          <div class="chart-container">
            <div class="chart-title">Delivery Status Distribution</div>
            <canvas id="deliveryStatusChart" style="max-height: 400px;"></canvas>
          </div>
        </div>

        <!-- Additional Logistics Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
          <div class="chart-container">
            <div class="chart-title">Route Performance</div>
            <canvas id="routePerformanceChart" style="max-height: 350px;" height="120"></canvas>
          </div>
          <div class="chart-container">
            <div class="chart-title">Fleet Status</div>
            <canvas id="fleetStatusChart" style="max-height: 350px;" height="120"></canvas>
          </div>
          <div class="chart-container">
            <div class="chart-title">On-Time Delivery Rate</div>
            <canvas id="deliveryRateChart" style="max-height: 350px;" height="120"></canvas>
          </div>
        </div>

        <!-- Fuel Consumption & Driver Performance -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="chart-container">
            <div class="chart-title">Fuel Consumption Trends</div>
            <canvas id="fuelConsumptionChart" style="max-height: 350px;" height="100"></canvas>
          </div>
          <div class="chart-container">
            <div class="chart-title">Driver Performance Metrics</div>
            <canvas id="driverPerformanceChart" style="max-height: 350px;" height="100"></canvas>
          </div>
        </div>
      </div>

      <!-- Enhanced Tables -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white p-4 rounded-lg shadow">
          <h3 class="text-lg font-bold mb-4">Recent Shipments</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
              <thead class="bg-gray-200">
                <tr>
                  <th class="p-2">Tracking ID</th>
                  <th class="p-2">Customer</th>
                  <th class="p-2">Destination</th>
                  <th class="p-2">Status</th>
                </tr>
              </thead>
              <tbody id="recentShipments"></tbody>
            </table>
          </div>
        </div>

        <div class="bg-white p-4 rounded-lg shadow">
          <h3 class="text-lg font-bold mb-4">Top Performing Routes</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
              <thead class="bg-gray-200">
                <tr>
                  <th class="p-2">Route</th>
                  <th class="p-2">Shipments</th>
                  <th class="p-2">Avg Time</th>
                  <th class="p-2">Success Rate</th>
                </tr>
              </thead>
              <tbody id="topRoutes"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('collapsed');
    }

    // Enhanced Logistics Demo Data
    const logisticsData = {
      shipmentVolume: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        data: [45, 52, 38, 67, 73, 41, 29]
      },
      deliveryStatus: {
        labels: ['Delivered', 'In Transit', 'Pending', 'Delayed'],
        data: [65, 20, 10, 5],
        colors: ['#28a745', '#007bff', '#fd7e14', '#dc3545']
      },
      routePerformance: {
        labels: ['Lagos-Abuja', 'Kano-Jos', 'PH-Warri', 'Ibadan-Oyo', 'Kaduna-Zaria'],
        data: [95, 88, 92, 78, 85]
      },
      fleetStatus: {
        labels: ['Active', 'Maintenance', 'Available'],
        data: [32, 8, 5],
        colors: ['#28a745', '#fd7e14', '#6c757d']
      },
      deliveryRate: {
        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
        data: [94, 89, 96, 92]
      },
      fuelConsumption: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        data: [2400, 2100, 2300, 1800, 2000, 1900]
      },
      driverPerformance: {
        labels: ['John D.', 'Sarah M.', 'Mike R.', 'Lisa K.', 'Tom B.'],
        data: [98, 94, 89, 96, 91]
      },
      recentShipments: [
        { trackingId: 'LT2025001', customer: 'Acme Corp', destination: 'Lagos', status: 'delivered' },
        { trackingId: 'LT2025002', customer: 'TechNova Ltd', destination: 'Abuja', status: 'transit' },
        { trackingId: 'LT2025003', customer: 'Global Supplies', destination: 'Kano', status: 'pending' },
        { trackingId: 'LT2025004', customer: 'MegaMart', destination: 'Port Harcourt', status: 'delivered' },
        { trackingId: 'LT2025005', customer: 'QuickServe', destination: 'Ibadan', status: 'delayed' }
      ],
      topRoutes: [
        { route: 'Lagos → Abuja', shipments: 145, avgTime: '6.2h', successRate: '98%' },
        { route: 'Kano → Jos', shipments: 132, avgTime: '3.5h', successRate: '96%' },
        { route: 'PH → Warri', shipments: 118, avgTime: '2.8h', successRate: '94%' },
        { route: 'Ibadan → Lagos', shipments: 98, avgTime: '2.1h', successRate: '99%' },
        { route: 'Kaduna → Zaria', shipments: 87, avgTime: '1.5h', successRate: '97%' }
      ]
    };

    // Initialize Charts
    function initializeCharts() {
      // Daily Shipment Volume
      new Chart(document.getElementById('shipmentVolumeChart'), {
        type: 'line',
        data: {
          labels: logisticsData.shipmentVolume.labels,
          datasets: [{
            label: 'Shipments',
            data: logisticsData.shipmentVolume.data,
            borderColor: '#007bff',
            backgroundColor: 'rgba(0, 123, 255, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } }
        }
      });

      // Delivery Status Distribution
      new Chart(document.getElementById('deliveryStatusChart'), {
        type: 'doughnut',
        data: {
          labels: logisticsData.deliveryStatus.labels,
          datasets: [{
            data: logisticsData.deliveryStatus.data,
            backgroundColor: logisticsData.deliveryStatus.colors
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });

      // Route Performance
      new Chart(document.getElementById('routePerformanceChart'), {
        type: 'bar',
        data: {
          labels: logisticsData.routePerformance.labels,
          datasets: [{
            data: logisticsData.routePerformance.data,
            backgroundColor: '#8b5cf6'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true, max: 100 },
            x: { ticks: { maxRotation: 45 } }
          }
        }
      });

      // Fleet Status
      new Chart(document.getElementById('fleetStatusChart'), {
        type: 'pie',
        data: {
          labels: logisticsData.fleetStatus.labels,
          datasets: [{
            data: logisticsData.fleetStatus.data,
            backgroundColor: logisticsData.fleetStatus.colors
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { position: 'bottom' } }
        }
      });

      // On-Time Delivery Rate
      new Chart(document.getElementById('deliveryRateChart'), {
        type: 'line',
        data: {
          labels: logisticsData.deliveryRate.labels,
          datasets: [{
            data: logisticsData.deliveryRate.data,
            borderColor: '#28a745',
            backgroundColor: 'rgba(40, 167, 69, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, max: 100 } }
        }
      });

      // Fuel Consumption Trends
      new Chart(document.getElementById('fuelConsumptionChart'), {
        type: 'bar',
        data: {
          labels: logisticsData.fuelConsumption.labels,
          datasets: [{
            label: 'Liters',
            data: logisticsData.fuelConsumption.data,
            backgroundColor: '#fd7e14'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } }
        }
      });

      // Driver Performance
      new Chart(document.getElementById('driverPerformanceChart'), {
        type: 'radar',
        data: {
          labels: logisticsData.driverPerformance.labels,
          datasets: [{
            label: 'Performance Score',
            data: logisticsData.driverPerformance.data,
            borderColor: '#0d9488',
            backgroundColor: 'rgba(13, 148, 136, 0.2)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            r: { beginAtZero: true, max: 100 }
          }
        }
      });
    }

    // Populate Tables
    function populateTables() {
      // Recent Shipments
      document.getElementById('recentShipments').innerHTML = logisticsData.recentShipments
        .map(shipment => `
            <tr>
              <td class="p-2">${shipment.trackingId}</td>
              <td class="p-2">${shipment.customer}</td>
              <td class="p-2">${shipment.destination}</td>
              <td class="p-2">
                <span class="status-badge status-${shipment.status}">
                  ${shipment.status.charAt(0).toUpperCase() + shipment.status.slice(1)}
                </span>
              </td>
            </tr>
          `).join('');

      // Top Routes
      document.getElementById('topRoutes').innerHTML = logisticsData.topRoutes
        .map(route => `
            <tr>
              <td class="p-2">${route.route}</td>
              <td class="p-2">${route.shipments}</td>
              <td class="p-2">${route.avgTime}</td>
              <td class="p-2" style="color: #28a745; font-weight: bold">${route.successRate}</td>
            </tr>
          `).join('');
    }

    // Try to fetch from API, fallback to demo data
    async function loadDashboard() {
      try {
        const response = await fetch("https://logitrack-w83a.onrender.com/api/dashboard");
        if (response.ok) {
          const data = await response.json();
          // If real API data structure matches, use it
          console.log("API data available:", data);
        }
      } catch (error) {
        console.log("Using demo data");
      }

      // Initialize with enhanced demo data
      initializeCharts();
      populateTables();
    }

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', loadDashboard);
  </script>
</body>

</html>