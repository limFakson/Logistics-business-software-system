<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Logistics Service - Fleet</title>
  <link rel="stylesheet" href="FleetPage.css" />
  <link rel="stylesheet" href="nav.css">
</head>

<body class="main">

  <!-- Sidebar Navigation -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button onclick="togglesidebar()">/|\</button>
      <span class="app-name">LogiTrack</span>
    </div>
    <ul class="menu">
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="Orderpage.html">Orders</a></li>
      <li ><a href="FleetPage.html" class="active">Fleet</a></li>
      <li><a href="reports.html">Reports</a></li>
      <li><a href="SettingPage.html">Settings</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="page main-content">
    <h2 class="page-title">ðŸš› Fleet Overview</h2>
    <div class="fleet-grid" id="fleetGrid"></div>
  </div>

  <!-- Modal for Fleet Details -->
  <div id="fleetModal" class="modal">
    <div class="modal-content">
      <span class="close" data-close="fleetModal">&times;</span>
      <h2>Fleet Details</h2>
      <div id="fleetModalBody"></div>
    </div>
  </div>

  <script src="index.js"></script>
  <script src="api.js"></script>
  <script>
    async function loadFleet() {
      const container = document.getElementById("fleetGrid");
      container.innerHTML = "<p class='loading'>Loading fleet data...</p>";

      try {
        const res = await fetch("http://localhost:8000/api/fleets/");
        if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);

        const fleets = await res.json();
        container.innerHTML = "";

        fleets.forEach(fleet => {
          const card = document.createElement("div");
          card.classList.add("fleet-card", fleet.status.toLowerCase());

          card.innerHTML = `
            <div class="fleet-info">
              <h3>${fleet.name}</h3>
              <p><strong>Driver:</strong> ${fleet.driver_name}</p>
              <p><strong>Vehicle:</strong> ${fleet.vehicle_type || "N/A"}</p>
              <p><strong>Last Maintenance:</strong> ${fleet.last_maintenance}</p>
            </div>
            <div class="status-badge">${fleet.status}</div>
          `;

          card.addEventListener("click", () => {
            document.getElementById("fleetModalBody").innerHTML = `
              <p><strong>Fleet Name:</strong> ${fleet.name}</p>
              <p><strong>Driver:</strong> ${fleet.driver_name}</p>
              <p><strong>Vehicle:</strong> ${fleet.vehicle_type || "N/A"}</p>
              <p><strong>Status:</strong> ${fleet.status}</p>
              <p><strong>Last Maintenance:</strong> ${fleet.last_maintenance}</p>
            `;
            showModal("fleetModal");
          });

          container.appendChild(card);
        });

      } catch (err) {
        console.error("Error loading fleet:", err);
        container.innerHTML = "<p class='error'>Failed to load fleet data.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", loadFleet);
  </script>
</body>

</html>